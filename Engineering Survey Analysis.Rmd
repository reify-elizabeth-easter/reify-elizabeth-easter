---
title: "Engineering Survey Analysis"
output: html_document
date: '2022-05-03'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(hrbrthemes)
library(plotly)
library(DT)

setwd("/Users/elizabetheaster/Documents")
```



```{r echo=FALSE, message=FALSE, , warning=FALSE}
# Load data and rename columns

df <- read_csv('Copy of Picasso feedback (Responses) - Form Responses 1.csv')
names(df) <- gsub(" ", "_", names(df))

squad_responses_cnt <- df %>% group_by(squad_name) %>% summarise(Responses = n()) %>% arrange(desc(Responses))
columns <- names(df)
columns <- columns[2:15]


#summary(df)
```

## Overview

```{r pressure, echo=FALSE, fig.height=600, fig.width= 900, message=FALSE}
# Calculate the mean response value for each question and each squad

means <- df[,2:16] %>% drop_na() %>%
  group_by(squad_name) %>%
  group_modify(~ {
    .x %>%
      purrr::map_dfc(mean) %>%
      mutate(nms = c("mean"))
  }) %>% ungroup() %>% mutate(across(2:15, round, 2)) %>% select(!last_col())

totals <- means %>% ungroup %>% 
  mutate(total =  select(.,I_know_what_Picasso_is.:Assembling_UI_is_a_pleasant_experience_when_using_Picasso_tooling.) %>% rowSums(na.rm = TRUE)) %>%
  arrange(desc(total))

totals_columns <- means %>% summarise(across(I_know_what_Picasso_is.:Assembling_UI_is_a_pleasant_experience_when_using_Picasso_tooling., sum)) %>%
  pivot_longer(columns, names_to = "question", values_to = "total_col") %>% arrange(desc(total_col))

best_at_picasso <- squad_responses_cnt %>% left_join(totals) %>% select(squad_name, Responses,total) %>% arrange(desc(total)) 


long_means <- means %>% pivot_longer(columns, names_to = "question", values_to = "mean") %>% left_join(best_at_picasso) %>% left_join(totals_columns) %>% arrange(desc(total),desc(total_col))


p <- ggplot(long_means,aes(x = reorder(question,total_col),y = reorder(squad_name,total),fill = mean, text = paste("Question:", reorder(question,total_col)))) +
geom_tile() +
  theme(axis.text.x = element_blank())+
  labs(x = "Question", y = "Squads")
  

best_at_picasso <- best_at_picasso %>% mutate(total = round(total/14,2))

kable(best_at_picasso %>% rename("Squad Name" = squad_name, "Number of Respondents"= Responses,"Average Response across all questions" = total))




```
## Heatmap of means

```{r echo=FALSE, fig.height=600, fig.width= 900, message=FALSE}


ggplotly(p,  height = 600, width=900, tooltip = c("text","mean")) 


```

Across all squads respondents need to know more about what CSS/SCSS/JS helpers are available in Picasso and how to identify when
components should be added to Picasso. Most squads know what Picasso is and are using it. Respondents from the source squad, Site Growth 1 and Site integrations squads tend to have a better understanding of Picasso as a whole.  

```{r eval=FALSE, include=FALSE}
##### NOT INCLUDED IN OUTPUT
# Chi-squared
sample <-  df %>% select(My_squad_is_using_Picasso.,squad_name)

sam <- table(sample)
kable(sam)
chisq <- chisq.test(sam)
chisq
library(corrplot)
corrplot(chisq$residuals, is.cor = FALSE)




```

## Bar charts by Question and Squad
These charts can be used to dig deeper into the individual responses by question and squad. 

```{r echo= FALSE, message = FALSE, warning = FALSE,results = 'asis'}


histo_data <- df[,2:16] %>% drop_na() %>%
  group_by(squad_name) 


squad_names <- distinct(histo_data[,15])
squad_vec <- pull(squad_names)

datalist <- list()
value_ <- data.frame(squad_name = squad_vec, value = rep(1:5,13)) %>% arrange(squad_name)



  
  dat1 <- histo_data[,1]
  col_x <- colnames(dat1)
  cat("####", gsub(x = col_x ,pattern="_"," "), "\n")
  dat2 <- histo_data %>% select(squad_name,col_x)
  dat <- dat2 %>% group_by(dat1[,1],squad_name) %>% rename(value = col_x ) %>% summarise(cnt= n()) %>% rename(!!paste0(col_x) := cnt )
  dat <- value_ %>% left_join(dat)
  dat[is.na(dat)] <- 0
 

plot_ly( dat, x = ~as.factor(value), y= ~as.factor(dat[,3]) ,symbol = ~squad_name ,type = 'bar') %>%
  layout(xaxis = list(title = 'Response'), 
         yaxis = list(title = 'Count'),
    updatemenus = list(
      list(
        type = "list",
        label = 'Category',
        buttons = list(
          list(method = "restyle",
               args = list('visible', c(TRUE, TRUE, TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)),
               label = "All squads"),
          list(method = "restyle",
               args = list('visible', c(TRUE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Integration Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, TRUE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Microsites"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Patient Discovery"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Reify Admin"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 1"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 2"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Integrations"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Networks"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Protocol"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE)),
               label = "Source Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE)),
               label = "Sponsor UX"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE)),
               label = "Technical Advisor"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE)),
               label = "Visits Squad")
          
          
        )
      )
    )
  )

###########################
  
  dat1 <- histo_data[,2]
  col_x <- colnames(dat1)
cat("####", gsub(x = col_x ,pattern="_"," "), "\n")
  dat2 <- histo_data %>% select(squad_name,col_x)
  dat <- dat2 %>% group_by(dat1[,1],squad_name) %>% rename(value = col_x ) %>% summarise(cnt= n()) %>% rename(!!paste0(col_x) := cnt )
  dat <- value_ %>% left_join(dat)
  dat[is.na(dat)] <- 0
 

plot_ly( dat, x = ~as.factor(value), y= ~as.factor(dat[,3]) ,symbol = ~squad_name ,type = 'bar') %>%
  layout(xaxis = list(title = 'Response'), 
         yaxis = list(title = 'Count'),
    updatemenus = list(
      list(
        type = "list",
        label = 'Category',
        buttons = list(
          list(method = "restyle",
               args = list('visible', c(TRUE, TRUE, TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)),
               label = "All squads"),
          list(method = "restyle",
               args = list('visible', c(TRUE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Integration Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, TRUE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Microsites"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Patient Discovery"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Reify Admin"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 1"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 2"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Integrations"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Networks"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Protocol"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE)),
               label = "Source Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE)),
               label = "Sponsor UX"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE)),
               label = "Technical Advisor"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE)),
               label = "Visits Squad")
          
          
        )
      )
    )
  )

###########################
  
  
  dat1 <- histo_data[,3]
  col_x <- colnames(dat1)
  cat("####", gsub(x = col_x ,pattern="_"," "), "\n")
  dat2 <- histo_data %>% select(squad_name,col_x)
  dat <- dat2 %>% group_by(dat1[,1],squad_name) %>% rename(value = col_x ) %>% summarise(cnt= n()) %>% rename(!!paste0(col_x) := cnt )
  dat <- value_ %>% left_join(dat)
  dat[is.na(dat)] <- 0
 

plot_ly( dat, x = ~as.factor(value), y= ~as.factor(dat[,3]) ,symbol = ~squad_name ,type = 'bar') %>%
  layout(xaxis = list(title = 'Response'), 
         yaxis = list(title = 'Count'),
    updatemenus = list(
      list(
        type = "list",
        label = 'Category',
        buttons = list(
          list(method = "restyle",
               args = list('visible', c(TRUE, TRUE, TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)),
               label = "All squads"),
          list(method = "restyle",
               args = list('visible', c(TRUE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Integration Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, TRUE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Microsites"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Patient Discovery"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Reify Admin"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 1"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 2"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Integrations"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Networks"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Protocol"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE)),
               label = "Source Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE)),
               label = "Sponsor UX"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE)),
               label = "Technical Advisor"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE)),
               label = "Visits Squad")
          
          
        )
      )
    )
  )

###########################
  
  dat1 <- histo_data[,4]
  col_x <- colnames(dat1)
  cat("####", gsub(x = col_x ,pattern="_"," "), "\n")
  dat2 <- histo_data %>% select(squad_name,col_x)
  dat <- dat2 %>% group_by(dat1[,1],squad_name) %>% rename(value = col_x ) %>% summarise(cnt= n()) %>% rename(!!paste0(col_x) := cnt )
  dat <- value_ %>% left_join(dat)
  dat[is.na(dat)] <- 0
 

plot_ly( dat, x = ~as.factor(value), y= ~as.factor(dat[,3]) ,symbol = ~squad_name ,type = 'bar') %>%
  layout(xaxis = list(title = 'Response'), 
         yaxis = list(title = 'Count'),
    updatemenus = list(
      list(
        type = "list",
        label = 'Category',
        buttons = list(
          list(method = "restyle",
               args = list('visible', c(TRUE, TRUE, TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)),
               label = "All squads"),
          list(method = "restyle",
               args = list('visible', c(TRUE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Integration Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, TRUE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Microsites"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Patient Discovery"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Reify Admin"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 1"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 2"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Integrations"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Networks"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Protocol"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE)),
               label = "Source Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE)),
               label = "Sponsor UX"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE)),
               label = "Technical Advisor"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE)),
               label = "Visits Squad")
          
          
        )
      )
    )
  )

###########################
  
    
  dat1 <- histo_data[,5]
  col_x <- colnames(dat1)
  cat("####", gsub(x = col_x ,pattern="_"," "), "\n")
  dat2 <- histo_data %>% select(squad_name,col_x)
  dat <- dat2 %>% group_by(dat1[,1],squad_name) %>% rename(value = col_x ) %>% summarise(cnt= n()) %>% rename(!!paste0(col_x) := cnt )
  dat <- value_ %>% left_join(dat)
  dat[is.na(dat)] <- 0
 

plot_ly( dat, x = ~as.factor(value), y= ~as.factor(dat[,3]) ,symbol = ~squad_name ,type = 'bar') %>%
  layout(xaxis = list(title = 'Response'), 
         yaxis = list(title = 'Count'),
    updatemenus = list(
      list(
        type = "list",
        label = 'Category',
        buttons = list(
          list(method = "restyle",
               args = list('visible', c(TRUE, TRUE, TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)),
               label = "All squads"),
          list(method = "restyle",
               args = list('visible', c(TRUE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Integration Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, TRUE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Microsites"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Patient Discovery"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Reify Admin"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 1"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 2"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Integrations"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Networks"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Protocol"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE)),
               label = "Source Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE)),
               label = "Sponsor UX"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE)),
               label = "Technical Advisor"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE)),
               label = "Visits Squad")
          
          
        )
      )
    )
  )

###########################
    
  dat1 <- histo_data[,6]
  col_x <- colnames(dat1)
  cat("####", gsub(x = col_x ,pattern="_"," "), "\n")
  dat2 <- histo_data %>% select(squad_name,col_x)
  dat <- dat2 %>% group_by(dat1[,1],squad_name) %>% rename(value = col_x ) %>% summarise(cnt= n()) %>% rename(!!paste0(col_x) := cnt )
  dat <- value_ %>% left_join(dat)
  dat[is.na(dat)] <- 0
 

plot_ly( dat, x = ~as.factor(value), y= ~as.factor(dat[,3]) ,symbol = ~squad_name ,type = 'bar') %>%
  layout(xaxis = list(title = 'Response'), 
         yaxis = list(title = 'Count'),
    updatemenus = list(
      list(
        type = "list",
        label = 'Category',
        buttons = list(
          list(method = "restyle",
               args = list('visible', c(TRUE, TRUE, TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)),
               label = "All squads"),
          list(method = "restyle",
               args = list('visible', c(TRUE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Integration Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, TRUE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Microsites"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Patient Discovery"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Reify Admin"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 1"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 2"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Integrations"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Networks"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Protocol"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE)),
               label = "Source Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE)),
               label = "Sponsor UX"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE)),
               label = "Technical Advisor"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE)),
               label = "Visits Squad")
          
          
        )
      )
    )
  )

###########################
    
  dat1 <- histo_data[,7]
  col_x <- colnames(dat1)
  cat("####", gsub(x = col_x ,pattern="_"," "), "\n")
  dat2 <- histo_data %>% select(squad_name,col_x)
  dat <- dat2 %>% group_by(dat1[,1],squad_name) %>% rename(value = col_x ) %>% summarise(cnt= n()) %>% rename(!!paste0(col_x) := cnt )
  dat <- value_ %>% left_join(dat)
  dat[is.na(dat)] <- 0
 

plot_ly( dat, x = ~as.factor(value), y= ~as.factor(dat[,3]) ,symbol = ~squad_name ,type = 'bar') %>%
  layout(xaxis = list(title = 'Response'), 
         yaxis = list(title = 'Count'),
    updatemenus = list(
      list(
        type = "list",
        label = 'Category',
        buttons = list(
          list(method = "restyle",
               args = list('visible', c(TRUE, TRUE, TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)),
               label = "All squads"),
          list(method = "restyle",
               args = list('visible', c(TRUE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Integration Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, TRUE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Microsites"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Patient Discovery"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Reify Admin"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 1"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 2"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Integrations"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Networks"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Protocol"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE)),
               label = "Source Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE)),
               label = "Sponsor UX"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE)),
               label = "Technical Advisor"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE)),
               label = "Visits Squad")
          
          
        )
      )
    )
  )

###########################
    
  dat1 <- histo_data[,8]
  col_x <- colnames(dat1)
  cat("####", gsub(x = col_x ,pattern="_"," "), "\n")
  dat2 <- histo_data %>% select(squad_name,col_x)
  dat <- dat2 %>% group_by(dat1[,1],squad_name) %>% rename(value = col_x ) %>% summarise(cnt= n()) %>% rename(!!paste0(col_x) := cnt )
  dat <- value_ %>% left_join(dat)
  dat[is.na(dat)] <- 0
 

plot_ly( dat, x = ~as.factor(value), y= ~as.factor(dat[,3]) ,symbol = ~squad_name ,type = 'bar') %>%
  layout(xaxis = list(title = 'Response'), 
         yaxis = list(title = 'Count'),
    updatemenus = list(
      list(
        type = "list",
        label = 'Category',
        buttons = list(
          list(method = "restyle",
               args = list('visible', c(TRUE, TRUE, TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)),
               label = "All squads"),
          list(method = "restyle",
               args = list('visible', c(TRUE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Integration Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, TRUE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Microsites"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Patient Discovery"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Reify Admin"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 1"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 2"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Integrations"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Networks"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Protocol"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE)),
               label = "Source Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE)),
               label = "Sponsor UX"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE)),
               label = "Technical Advisor"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE)),
               label = "Visits Squad")
          
          
        )
      )
    )
  )

###########################
    
  dat1 <- histo_data[,9]
  col_x <- colnames(dat1)
  cat("####", gsub(x = col_x ,pattern="_"," "), "\n")
  dat2 <- histo_data %>% select(squad_name,col_x)
  dat <- dat2 %>% group_by(dat1[,1],squad_name) %>% rename(value = col_x ) %>% summarise(cnt= n()) %>% rename(!!paste0(col_x) := cnt )
  dat <- value_ %>% left_join(dat)
  dat[is.na(dat)] <- 0
 

plot_ly( dat, x = ~as.factor(value), y= ~as.factor(dat[,3]) ,symbol = ~squad_name ,type = 'bar') %>%
  layout(xaxis = list(title = 'Response'), 
         yaxis = list(title = 'Count'),
    updatemenus = list(
      list(
        type = "list",
        label = 'Category',
        buttons = list(
          list(method = "restyle",
               args = list('visible', c(TRUE, TRUE, TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)),
               label = "All squads"),
          list(method = "restyle",
               args = list('visible', c(TRUE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Integration Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, TRUE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Microsites"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Patient Discovery"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Reify Admin"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 1"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 2"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Integrations"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Networks"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Protocol"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE)),
               label = "Source Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE)),
               label = "Sponsor UX"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE)),
               label = "Technical Advisor"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE)),
               label = "Visits Squad")
          
          
        )
      )
    )
  )

###########################
    
  dat1 <- histo_data[,10]
  col_x <- colnames(dat1)
  cat("####", gsub(x = col_x ,pattern="_"," "), "\n")
  dat2 <- histo_data %>% select(squad_name,col_x)
  dat <- dat2 %>% group_by(dat1[,1],squad_name) %>% rename(value = col_x ) %>% summarise(cnt= n()) %>% rename(!!paste0(col_x) := cnt )
  dat <- value_ %>% left_join(dat)
  dat[is.na(dat)] <- 0
 

plot_ly( dat, x = ~as.factor(value), y= ~as.factor(dat[,3]) ,symbol = ~squad_name ,type = 'bar') %>%
  layout(xaxis = list(title = 'Response'), 
         yaxis = list(title = 'Count'),
    updatemenus = list(
      list(
        type = "list",
        label = 'Category',
        buttons = list(
          list(method = "restyle",
               args = list('visible', c(TRUE, TRUE, TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)),
               label = "All squads"),
          list(method = "restyle",
               args = list('visible', c(TRUE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Integration Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, TRUE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Microsites"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Patient Discovery"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Reify Admin"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 1"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 2"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Integrations"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Networks"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Protocol"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE)),
               label = "Source Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE)),
               label = "Sponsor UX"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE)),
               label = "Technical Advisor"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE)),
               label = "Visits Squad")
          
          
        )
      )
    )
  )

###########################
    
  dat1 <- histo_data[,11]
  col_x <- colnames(dat1)
  cat("####", gsub(x = col_x ,pattern="_"," "), "\n")
  dat2 <- histo_data %>% select(squad_name,col_x)
  dat <- dat2 %>% group_by(dat1[,1],squad_name) %>% rename(value = col_x ) %>% summarise(cnt= n()) %>% rename(!!paste0(col_x) := cnt )
  dat <- value_ %>% left_join(dat)
  dat[is.na(dat)] <- 0
 

plot_ly( dat, x = ~as.factor(value), y= ~as.factor(dat[,3]) ,symbol = ~squad_name ,type = 'bar') %>%
  layout(xaxis = list(title = 'Response'), 
         yaxis = list(title = 'Count'),
    updatemenus = list(
      list(
        type = "list",
        label = 'Category',
        buttons = list(
          list(method = "restyle",
               args = list('visible', c(TRUE, TRUE, TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)),
               label = "All squads"),
          list(method = "restyle",
               args = list('visible', c(TRUE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Integration Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, TRUE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Microsites"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Patient Discovery"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Reify Admin"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 1"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 2"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Integrations"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Networks"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Protocol"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE)),
               label = "Source Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE)),
               label = "Sponsor UX"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE)),
               label = "Technical Advisor"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE)),
               label = "Visits Squad")
          
          
        )
      )
    )
  )

###########################
    
  dat1 <- histo_data[,12]
  col_x <- colnames(dat1)
  cat("####", gsub(x = col_x ,pattern="_"," "), "\n")
  dat2 <- histo_data %>% select(squad_name,col_x)
  dat <- dat2 %>% group_by(dat1[,1],squad_name) %>% rename(value = col_x ) %>% summarise(cnt= n()) %>% rename(!!paste0(col_x) := cnt )
  dat <- value_ %>% left_join(dat)
  dat[is.na(dat)] <- 0
 

plot_ly( dat, x = ~as.factor(value), y= ~as.factor(dat[,3]) ,symbol = ~squad_name ,type = 'bar') %>%
  layout(xaxis = list(title = 'Response'), 
         yaxis = list(title = 'Count'),
    updatemenus = list(
      list(
        type = "list",
        label = 'Category',
        buttons = list(
          list(method = "restyle",
               args = list('visible', c(TRUE, TRUE, TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)),
               label = "All squads"),
          list(method = "restyle",
               args = list('visible', c(TRUE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Integration Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, TRUE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Microsites"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Patient Discovery"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Reify Admin"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 1"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 2"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Integrations"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Networks"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Protocol"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE)),
               label = "Source Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE)),
               label = "Sponsor UX"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE)),
               label = "Technical Advisor"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE)),
               label = "Visits Squad")
          
          
        )
      )
    )
  )

###########################
    
  dat1 <- histo_data[,13]
  col_x <- colnames(dat1)
  cat("####", gsub(x = col_x ,pattern="_"," "), "\n")
  
  dat2 <- histo_data %>% select(squad_name,col_x)
  dat <- dat2 %>% group_by(dat1[,1],squad_name) %>% rename(value = col_x ) %>% summarise(cnt= n()) %>% rename(!!paste0(col_x) := cnt )
  dat <- value_ %>% left_join(dat)
  dat[is.na(dat)] <- 0
 

plot_ly( dat, x = ~as.factor(value), y= ~as.factor(dat[,3]) ,symbol = ~squad_name ,type = 'bar') %>%
  layout(xaxis = list(title = 'Response'), 
         yaxis = list(title = 'Count'),
    updatemenus = list(
      list(
        type = "list",
        label = 'Category',
        buttons = list(
          list(method = "restyle",
               args = list('visible', c(TRUE, TRUE, TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)),
               label = "All squads"),
          list(method = "restyle",
               args = list('visible', c(TRUE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Integration Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, TRUE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Microsites"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Patient Discovery"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Reify Admin"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 1"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 2"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Integrations"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Networks"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Protocol"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE)),
               label = "Source Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE)),
               label = "Sponsor UX"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE)),
               label = "Technical Advisor"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE)),
               label = "Visits Squad")
          
          
        )
      )
    )
  )

###########################
    
  dat1 <- histo_data[,14]
  col_x <- colnames(dat1)
  cat("####", gsub(x = col_x ,pattern="_"," "), "\n")

  dat2 <- histo_data %>% select(squad_name,col_x)
  dat <- dat2 %>% group_by(dat1[,1],squad_name) %>% rename(value = col_x ) %>% summarise(cnt= n()) %>% rename(!!paste0(col_x) := cnt )
  dat <- value_ %>% left_join(dat)
  dat[is.na(dat)] <- 0
 

plot_ly( dat, x = ~as.factor(value), y= ~as.factor(dat[,3]) ,symbol = ~squad_name ,type = 'bar') %>%
  layout(xaxis = list(title = 'Response'), 
         yaxis = list(title = 'Count'),
    updatemenus = list(
      list(
        type = "list",
        label = 'Category',
        buttons = list(
          list(method = "restyle",
               args = list('visible', c(TRUE, TRUE, TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)),
               label = "All squads"),
          list(method = "restyle",
               args = list('visible', c(TRUE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Integration Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, TRUE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Microsites"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Patient Discovery"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Reify Admin"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 1"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Growth 2"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Integrations"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Networks"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE)),
               label = "Site Protocol"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE,FALSE)),
               label = "Source Squad"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE,FALSE)),
               label = "Sponsor UX"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,FALSE)),
               label = "Technical Advisor"),
          list(method = "restyle",
               args = list('visible', c(FALSE, FALSE, FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE)),
               label = "Visits Squad")
          
          
        )
      )
    )
  )









```

## Free Text Analysis
Summary of the short answer questions. The sentiment tables show the number of words that had either a positive or negative sentiment. 

```{r echo= FALSE, message=FALSE, warning=FALSE, results = 'asis'}
library("tm")
library("SnowballC")
library("wordcloud")
library("RColorBrewer")
library("syuzhet")
library(tidytext)

sent <- get_sentiments("bing")


for(x in 17:19){
  
text_df_q1 <- df[,x] %>% drop_na()

text_q1 <- Corpus(VectorSource(text_df_q1))


toSpace <- content_transformer(function (x , pattern ) gsub(pattern, " ", x))

cleaned_text_q1 <- text_q1 %>% tm_map( toSpace, "n/")
cleaned_text_q1 <- cleaned_text_q1 %>% tm_map( toSpace, "^c\\(|\\)$")


cleaned_text_q1 <- tm_map(cleaned_text_q1, content_transformer(tolower))
cleaned_text_q1 <- tm_map(cleaned_text_q1, removeWords, stopwords("english"))
cleaned_text_q1 <- tm_map(cleaned_text_q1, removePunctuation)
cleaned_text_q1 <- tm_map(cleaned_text_q1, removeWords, c("design", "like","use")) 

cleaned_text_stem <- tm_map(cleaned_text_q1, stemDocument)

stems <- as.character(cleaned_text_stem[[1]]$content)
n_char_vec_stem <- unlist(strsplit(stems, split = ' '))

complete_doc <- stemCompletion(n_char_vec_stem, cleaned_text_q1) 
c <-Corpus(VectorSource(complete_doc))

# Build a term-document matrix
TextDoc_dtm <- TermDocumentMatrix(c)
dtm_m <- as.matrix(TextDoc_dtm)

dtm_v <- sort(rowSums(dtm_m),decreasing=TRUE)
dtm_d <- data.frame(word = names(dtm_v),freq=dtm_v)



cat("###", gsub(x = colnames(df[x]),pattern="_"," "), "\n")


words_df <- tibble(complete_doc) %>% rename(word = complete_doc )

words_sent <- words_df %>% left_join(sent) %>% drop_na()

overall_sent <- words_sent %>% group_by(sentiment) %>% summarise(Count = n())



set.seed(1234)
wordcloud(words = dtm_d$word, freq = dtm_d$freq, min.freq = 3,
         max.words=100, random.order=FALSE, rot.per=0.40, 
         colors=brewer.pal(8, "Dark2"))


cat("\n")
print(kable(overall_sent))
cat("\n")
}


```




